<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        video {
            width: 100%;
            margin-bottom: 20px;
        }
        .video-container {
            margin-bottom: 40px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        h2 {
            margin-top: 0;
        }
        .status-info {
            margin-top: 10px;
            padding: 8px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .status-item {
            margin: 5px 0;
        }
        .success {
            color: green;
        }
        .warning {
            color: orange;
        }
        .error {
            color: red;
        }
        .test-button {
            margin-top: 10px;
            padding: 5px 10px;
            cursor: pointer;
        }
        #debug-dashboard {
            margin-top: 30px;
            padding: 15px;
            background-color: #eef;
            border: 1px solid #ddf;
        }
        .file-check {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Video Test Page</h1>
    <p>This page tests if the videos load correctly.</p>
    
    <div id="debug-dashboard">
        <h2>Video Debug Dashboard</h2>
        <div id="browser-info"></div>
        <div id="video-support-info"></div>
    </div>
    
    <div class="file-check">
        <h3>File Availability Check</h3>
        <p>Testing if file is accessible via fetch:</p>
        <div id="fetch-status">Checking...</div>
        <button id="test-fetch" class="test-button">Recheck File Availability</button>
    </div>
    
    <div class="video-container">
        <h2>Test 1: Direct URL</h2>
        <video controls>
            <source src="../supp/others/videos/2011_09_26_drive_0002_sync_casualSAM.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div>Path: recordings/breakdance-flare.mp4</div>
        <div class="status-info" id="status-1"></div>
        <button class="test-button" data-video-index="0">Force Play</button>
    </div>

    <div class="video-container">
        <h2>Test 2: Alternate Path</h2>
        <video controls>
            <source src="./recordings/breakdance-flare.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div>Path: ./recordings/breakdance-flare.mp4</div>
        <div class="status-info" id="status-2"></div>
        <button class="test-button" data-video-index="1">Force Play</button>
    </div>

    <div class="video-container">
        <h2>Test 3: Full URL</h2>
        <video controls>
            <source src="https://davidyao99.github.io/uni4d/recordings/breakdance-flare.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div>Path: https://davidyao99.github.io/uni4d/recordings/breakdance-flare.mp4</div>
        <div class="status-info" id="status-3"></div>
        <button class="test-button" data-video-index="2">Force Play</button>
    </div>

    <div class="video-container">
        <h2>Test 4: With Playsinline Attribute</h2>
        <video controls playsinline>
            <source src="recordings/breakdance-flare.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div>Path: recordings/breakdance-flare.mp4 (with playsinline)</div>
        <div class="status-info" id="status-4"></div>
        <button class="test-button" data-video-index="3">Force Play</button>
    </div>

    <div class="video-container">
        <h2>Test 5: With Preload Attribute</h2>
        <video controls preload="auto">
            <source src="recordings/breakdance-flare.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div>Path: recordings/breakdance-flare.mp4 (with preload="auto")</div>
        <div class="status-info" id="status-5"></div>
        <button class="test-button" data-video-index="4">Force Play</button>
    </div>

    <script>
        // Add browser information
        const browserInfo = document.getElementById('browser-info');
        browserInfo.innerHTML = `
            <p><strong>Browser Information:</strong></p>
            <p>User Agent: ${navigator.userAgent}</p>
        `;

        // Check video support
        const videoSupportInfo = document.getElementById('video-support-info');
        const testVideo = document.createElement('video');
        videoSupportInfo.innerHTML = `
            <p><strong>Video Support Information:</strong></p>
            <p>Video element supported: ${!!testVideo}</p>
            <p>Can play MP4 (H.264): ${testVideo.canPlayType('video/mp4; codecs="avc1.42E01E"') || 'not supported'}</p>
        `;

        // Test file accessibility using fetch
        function checkFileAvailability() {
            const fetchStatus = document.getElementById('fetch-status');
            fetchStatus.innerHTML = 'Checking...';
            
            const paths = [
                'recordings/breakdance-flare.mp4',
                './recordings/breakdance-flare.mp4',
                'https://davidyao99.github.io/uni4d/recordings/breakdance-flare.mp4'
            ];
            
            const results = [];
            
            Promise.all(paths.map((path, index) => {
                return fetch(path, { method: 'HEAD' })
                    .then(response => {
                        results.push({
                            path,
                            success: response.ok,
                            status: response.status,
                            statusText: response.statusText
                        });
                    })
                    .catch(error => {
                        results.push({
                            path,
                            success: false,
                            error: error.message
                        });
                    });
            }))
            .then(() => {
                let html = '<ul>';
                results.forEach(result => {
                    const statusClass = result.success ? 'success' : 'error';
                    html += `<li class="${statusClass}">
                        <strong>${result.path}</strong>: 
                        ${result.success ? 
                            `Available (HTTP ${result.status} ${result.statusText})` : 
                            `Not available (${result.error || 'unknown error'})`}
                    </li>`;
                });
                html += '</ul>';
                fetchStatus.innerHTML = html;
            });
        }
        
        // Run file check on page load
        checkFileAvailability();
        
        // Add event listener for recheck button
        document.getElementById('test-fetch').addEventListener('click', checkFileAvailability);

        // Add comprehensive event listeners to detect video states
        document.querySelectorAll('video').forEach((video, index) => {
            const statusDiv = document.getElementById(`status-${index+1}`);
            
            function updateStatus(type, message, className = '') {
                const statusItem = document.createElement('div');
                statusItem.className = `status-item ${className}`;
                statusItem.textContent = `${type}: ${message}`;
                statusDiv.appendChild(statusItem);
                console.log(`Video ${index+1} ${type}:`, message);
            }
            
            // Remove autoplay to avoid policy issues
            video.removeAttribute('autoplay');
            
            // Add muted for better autoplay chances
            video.muted = true;
            
            // Error events
            video.addEventListener('error', function(e) {
                const errorMessage = e.target.error ? 
                    `Code: ${e.target.error.code}, Message: ${e.target.error.message || 'Unknown error'}` : 
                    'Unknown error';
                updateStatus('Error', errorMessage, 'error');
            }, true);
            
            video.querySelector('source').addEventListener('error', function(e) {
                updateStatus('Source Error', `Failed to load: ${this.src}`, 'error');
            }, true);
            
            // Loading events
            video.addEventListener('loadstart', function() {
                updateStatus('Info', 'Video loading started');
            });
            
            video.addEventListener('loadedmetadata', function() {
                updateStatus('Info', 'Metadata loaded', 'success');
            });
            
            video.addEventListener('loadeddata', function() {
                updateStatus('Success', 'Video data loaded and ready to play', 'success');
            });
            
            video.addEventListener('canplay', function() {
                updateStatus('Success', 'Can start playing', 'success');
            });
            
            video.addEventListener('canplaythrough', function() {
                updateStatus('Success', 'Can play through without buffering', 'success');
            });
            
            // Playback events
            video.addEventListener('play', function() {
                updateStatus('Info', 'Video started playing', 'success');
            });
            
            video.addEventListener('pause', function() {
                updateStatus('Info', 'Video paused');
            });
            
            video.addEventListener('waiting', function() {
                updateStatus('Warning', 'Video is waiting for more data', 'warning');
            });
            
            video.addEventListener('stalled', function() {
                updateStatus('Warning', 'Video download stalled', 'warning');
            });
            
            video.addEventListener('suspend', function() {
                updateStatus('Info', 'Media loading suspended');
            });
        });
        
        // Add click handler to force play buttons
        document.querySelectorAll('.test-button[data-video-index]').forEach(button => {
            button.addEventListener('click', function() {
                const videoIndex = this.getAttribute('data-video-index');
                const video = document.querySelectorAll('video')[videoIndex];
                
                if (video) {
                    // Make sure it's muted to increase chances of autoplay working
                    video.muted = true;
                    
                    video.play()
                        .then(() => {
                            const statusDiv = document.getElementById(`status-${parseInt(videoIndex)+1}`);
                            const statusItem = document.createElement('div');
                            statusItem.className = 'status-item success';
                            statusItem.textContent = 'Force play succeeded';
                            statusDiv.appendChild(statusItem);
                        })
                        .catch(err => {
                            const statusDiv = document.getElementById(`status-${parseInt(videoIndex)+1}`);
                            const statusItem = document.createElement('div');
                            statusItem.className = 'status-item error';
                            statusItem.textContent = `Force play failed: ${err.message}`;
                            statusDiv.appendChild(statusItem);
                        });
                }
            });
        });
    </script>
</body>
</html>
